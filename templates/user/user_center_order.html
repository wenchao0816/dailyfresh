{% extends 'base/base_user_center.html' %}
{% load static %}
{% block content %}
		<div class="right_content clearfix">
            <h3 class="common_title2">全部订单</h3>
            {% for order in pages.object_list %}
                <ul class="order_list_th w978 clearfix">
                    <li class="col01">{{ order.create_time }}</li>
                    <li class="col02">订单号：{{ order.order_id }}</li>
                    <li class="col02 stress">{{ order.status }}</li>
                </ul>
                <table class="order_list_table w980">
                    <tbody>
                        <tr>
                            <td width="55%">
                                {% for sku in order.skus %}
                                    <ul class="order_goods_list clearfix">
                                        <li class="col01"><img src={% static "images/goods02.jpg" %}></li>
                                        <li class="col02">{{ sku.SKU.goods_name }}<em>{{ sku.price }}元/{{ sku.SKU.unit }}</em></li>
                                        <li class="col03">{{ sku.goods_amount|floatformat:'0' }}</li>
                                        <li class="col04">{{ sku.money|floatformat:'2' }}元</li>
                                    </ul>
                                {% endfor %}
                            </td>
                            <td width="15%">{{ order.money|floatformat:'2' }}元</td>
                            <td width="15%">{{ order.status }}</td>
                            {% if order.status == '待支付' %}
                                <td width="15%"><a href="#" order_id="{{ order.order_id }}" class="oper_btn">去支付</a></td>
                            {% elif order.status == '支付成功' %}
                                <td width="15%"><a href="#" order_id="{{ order.order_id }}" class="oper_btn">查看物流</a></td>
                            {% endif %}
                        </tr>
                    </tbody>
                </table>
            {% empty %}
                您没有已提交订单！
            {% endfor %}
            <div class="pagenation">
                    {% if pages.has_previous %}
                        <a href="{% url 'user:order' pages.previous_page_number %}">上一页</a>
                    {% endif %}
                    {% for page in page_list %}
                        {% if NO == page %}
                            <a href="{% url 'user:order' page %}" class="active">{{ page }}</a>
                        {% else %}
                            <a href="{% url 'user:order' page %}">{{ page }}</a>
                        {% endif %}
                    {% endfor %}
                    {% if pages.has_next %}
                        <a href="{% url 'user:order' pages.next_page_number %}">下一页></a>
                    {% endif %}

            </div>
		</div>
    {% csrf_token %}
{% endblock content %}
{% block bottom_files %}
    <script src="{% static 'js/jquery-1.12.4.min.js' %}"></script>
    <script>
        $('.oper_btn').click(function () {
            var order_id = $(this).attr('order_id');
            var csrf = $('input[name="csrfmiddlewaretoken"]').val();
            var data = {
                'order_id': order_id,
                'csrfmiddlewaretoken': csrf
            };
            $.post('/order/pay', data, function (data) {
                if(data.code == 200){
                    window.open(data.url)
                    var data = {
                        'order_id': order_id,
                        'csrfmiddlewaretoken': csrf
                    };
                    $.post('/order/check', data, function (data) {
                        if(data.code == 200){
                            location.reload()
                        }else{
                            alert(data.errmsg)
                        }
                    })
                }else{
                    alert(data.errmsg)
                }
            })
        })
    </script>
{% endblock bottom_files %}