{% extends 'base/base.html' %}
{% load static %}
{% block search_bar %}
	<div class="search_bar clearfix">
		<a href="{% url 'goods:index' %}" class="logo fl"><img alt="logo" src={% static 'images/logo.png'%}></a>
		<div class="search_con fl">
            <form action="/search" method="get">
                <input type="text" class="input_text fl" name="q" placeholder="搜索商品">
                <input type="submit" class="input_btn fr" name="" value="搜索">
            </form>
		</div>
	</div>
{% endblock search_bar %}
{% block body_on %}
    <div class="navbar_con">
		<div class="navbar clearfix">
			<ul class="navlist fl">
				<li><a href={% url 'goods:index' %}>首页</a></li>
				<li class="interval">|</li>
				<li><a href="">手机生鲜</a></li>
				<li class="interval">|</li>
				<li><a href="">抽奖</a></li>
			</ul>
		</div>
	</div>
{% endblock body_on %}
{% block body %}
	<div class="breadcrumb">
		<a href="#">搜索关键词：{{ query }}</a>
		<span>></span>
		<a href="#">搜索结果</a>
	</div>

	<div class="main_wrap clearfix">
		<div class="r_wrap fr clearfix">
			<ul class="goods_type_list clearfix">
                {% for search in page %}
                    <li>
                        <a href={% url 'goods:detail' search.object.id %}><img src={{ search.object.pictures.url }}></a>
                        <h4><a href="{% url 'goods:detail' search.object.id %}">{{ search.object.goods_name }}</a></h4>
                        <div class="operate">
                            <span class="prize">￥{{ search.object.price }}</span>
                            <span class="unit">{{ search.object.price }}/{{ search.object.unit }}</span>
                            <a href="javascript:;" goods_id="{{ search.object.id }}"class="add_goods" title="加入购物车"></a>
                        </div>
                    </li>
                {% endfor %}
			</ul>

			<div class="pagenation">
                {% if page.has_previous %}
                    <a href="/search?q={{ query }}&page={{ page.previous_page_num }}">上一页</a>
                {% endif %}
                {% for num in paginator.page_range %}
                    {% if num == page %}
                        <a href="#" class="active">{{ num }}</a>
                    {% else %}
                        <a href="/search?q={{ query }}&page={{ num }}">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                {% if sku_pages.has_next %}
                    <a href="/search?q={{ query }}&page={{ page.next_page_num }}">下一页></a>
                {% endif %}
			</div>
		</div>
	</div>
    {% csrf_token %}
{% endblock body %}
{% block bottom_files %}
    <script src="{% static 'js/jquery-1.12.4.min.js' %}"></script>
    <script>
    $('.add_goods').click(function () {
            var goods_id = $(this).attr('goods_id')
            var count = 1
            var csrf = $("input[name='csrfmiddlewaretoken']").val()
            var data = {
                'goods_id': goods_id,
                'goods_num': count,
                'csrfmiddlewaretoken': csrf
            }
            $.post('/goodscar/addcart', data, function (data) {
                if(data.code === 200){
                    alert(data.errmsg)
                }
                else{
                    alert(data.errmsg)
                }
            })
        })
    </script>
{% endblock bottom_files %}